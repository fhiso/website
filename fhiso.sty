% Basic fonts
\usepackage[no-math]{fontspec}
\defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\setmainfont{Noto Serif}
\setsansfont{Noto Sans}
\setmonofont{Noto Mono}

% Arabic support
\usepackage{ucharclasses}
\usepackage{ifthen}
\newfontfamily{\Arabicmainfont}[Script=Arabic, Scale=1]{Noto Naskh Arabic}
\newfontfamily{\Arabicmonofont}[Script=Arabic, Scale=0.8]{Noto Kufi Arabic}
\newcommand{\fhisoArabic}{%
  \ifthenelse{\equal{\f@family}{NotoMono(0)}}{\Arabicmonofont}{\Arabicmainfont}%
}

\setTransitionsFor{Arabic}{\begingroup\fhisoArabic}{\endgroup}


% Japanese support
% Note: this must come after \usepackage{ucharclasses} or we get spurious 
% spaces within ``\texttt{...}''.
\usepackage{xeCJK}
\setCJKmainfont[Script=Hangul,Language=Korean]{Noto Sans CJK JP}

% Section title style
\usepackage{sectsty}
\allsectionsfont{\sffamily}
\newcommand\titlefont{\bfseries\huge\sffamily\nohang}
\sectionfont{\Large\sffamily\nohang}
\subsectionfont{\large\sffamily\nohang}
\subsubsectionfont{\normalsize\sffamily\nohang}
\usepackage{titling}
\renewcommand{\maketitlehooka}{\sffamily}
\newcommand\chapter[1]{}

% Page headers and footers
\usepackage[a4paper]{geometry}
\usepackage{fancyhdr}
\pagestyle{fancy}
\pagenumbering{arabic}
\fancyhf{}
\rhead{\itshape \@title}
\cfoot{\thepage}
\fancypagestyle{empty}{
  \setlength\headheight{93pt}
  \fancyhf{}
  \chead{\includegraphics[scale=1]{logo.png}}
}

\usepackage{enumitem}
\setlist[itemize]{noitemsep, topsep=0pt, label=---}
\setlist[enumerate]{noitemsep, topsep=0pt}

% Title page
\newcommand{\fhisotitle}{
\thispagestyle{empty}
\begin{center}

\vspace{1em}
{\titlefont{\@title}}

\vspace{2em}
{\large\sffamily\bfseries{\@date}}

\vspace{1em}
\end{center}
}

% The 'bidi' package redefines \maketitle (which also breaks the 'titling'
% package).  This defines it back to \fhisotitle.
% Unfortunately we can't just import 'bidi' now, because it needs to be
% imported after a bunch of other stuff in the template.
\newcommand{\fhisoFinal}{\renewcommand{\maketitle}{\fhisotitle}}

% Classes that are inserted by pclasses.pl
% They're done in this roundabout way so that the use of an undefined 
% class doesn't prevent compilation of the document.
\newcommand{\definefhisoclass}[3]{
  \expandafter\def\csname fhisoopenclass@#1\endcsname{#2}
  \expandafter\def\csname fhisocloseclass@#1\endcsname{#3}
}

\newcommand{\fhisoopenclass}[1]{%
 \ifcsname fhisoopenclass@#1\endcsname%
   \csname fhisoopenclass@#1\endcsname%
 \fi%
}

\newcommand{\fhisocloseclass}[2]{%
 \ifcsname fhisocloseclass@#1\endcsname%
   \csname fhisocloseclass@#1\endcsname%
 \fi%
}

% This is where we define FHISO classes.  
% Syntax is much the same as for \newenvironment.
\definefhisoclass{note}{[\textit{Note} --- }{]}
